# 三国志：群雄割据190

> 基于历史的三国策略游戏，模拟公元190年关东联军讨伐董卓的乱世格局

## 📖 游戏简介

公元190年，汉室衰微，天下大乱。董卓挟天子以令诸侯，占据洛阳、长安两大都城。关东诸侯会盟讨董，袁绍为盟主，曹操、刘备等群雄并起。然联军各怀心思，貌合神离。乱世已至，英雄当立。

本游戏采用回合制策略玩法，玩家扮演一方诸侯，通过内政发展、军事征伐、外交计谋等手段，在三国乱世中谋求霸业。

## ✨ 核心特性

### 🎮 游戏系统
- **AI决策系统** - 智能AI自动决策、威胁评估、战略规划
- **战斗系统** - 基于武将属性的战斗计算、单挑/秒杀判定
- **内政系统** - 商业/农业开发、征兵、资源管理
- **回合系统** - 行动力机制、月度/年度事件
- **LLM集成** - AI生成历史叙事和策略建议

### 📊 游戏数据
- **4大势力** - 董卓、曹操、袁绍、刘备
- **6座城市** - 洛阳、长安、陈留、南皮、邺、平原
- **23位武将** - 完整的五维属性（统帅、武力、智力、政治、魅力）

### 💾 存档功能
- 自动存档（每回合自动保存）
- 多槽位手动存档
- 本地持久化存储（LZ-String压缩）

### 🎨 用户界面
- 三栏式布局（势力信息、拓扑地图、新闻流）
- SVG拓扑地图显示城市和连接关系
- 实时战斗指示器
- 军师对话系统
- 开场叙事动画

## 🛠 技术栈

- **前端框架**: React 19.2.0
- **语言**: TypeScript 5.9.3
- **构建工具**: Vite 7.2.4
- **状态管理**: React Context
- **测试框架**: Vitest 4.0.16
- **属性测试**: fast-check 4.5.1
- **代码规范**: ESLint + Prettier
- **压缩库**: lz-string 1.5.0

## 🚀 快速开始

### 环境要求
- Node.js >= 18.0.0
- npm >= 9.0.0

### 安装依赖
```bash
npm install
```

### 开发模式
```bash
npm run dev
```

访问 http://localhost:5173 即可开始游戏

### 构建生产版本
```bash
npm run build
```

### 运行测试
```bash
# 运行所有测试
npm run test

# 监听模式
npm run test:watch

# UI模式
npm run test:ui
```

### 代码格式化
```bash
npm run format
```

## 📁 项目结构

```
sanguo-190/
├── src/
│   ├── components/       # UI组件
│   │   ├── LeftSidebar/  # 左侧栏（势力、城市、指令）
│   │   ├── MapView/      # 拓扑地图
│   │   ├── NewsFeed/     # 新闻流
│   │   ├── AdvisorDialog/# 军师对话
│   │   └── SaveLoadModal/# 存档界面
│   ├── systems/          # 游戏系统
│   │   ├── aiSystem.ts   # AI决策
│   │   ├── battle.ts     # 战斗计算
│   │   ├── domestic.ts   # 内政管理
│   │   ├── turnSystem.ts # 回合管理
│   │   └── gameLoop.ts   # 游戏循环
│   ├── services/         # 服务层
│   │   ├── llm/          # LLM集成
│   │   ├── storageService.ts # 存储服务
│   │   └── saveLoad.ts   # 存档服务
│   ├── data/             # 游戏数据
│   │   └── scenario190.ts# 190年剧本
│   ├── types/            # 类型定义
│   ├── store/            # 状态管理
│   └── App.tsx           # 主应用
├── public/               # 静态资源
└── package.json
```

## 🎯 游戏玩法

### 行动力机制
- 每回合拥有3点行动力（AP）
- 内政指令消耗1 AP（开发、征兵、探索）
- 军事指令消耗2 AP（出征）
- 查看详情不消耗AP

### 内政管理
- **开发商业/农业** - 提升城市收入和粮食产量
- **征兵** - 消耗金钱和人口招募士兵
- **人才探索** - 寻访在野武将

### 军事征伐
- **出征** - 选择武将率军攻打相邻城市
- **战斗计算** - 基于兵力、武力、统帅等属性
- **单挑系统** - 武力差≤10时有5%概率触发
- **秒杀机制** - 武力差>20时有1%概率触发

### AI行为
- 威胁评估（评估相邻势力威胁）
- 优先征兵（兵力不足时）
- 智能攻击（评估胜率后决定是否进攻）
- 内政开发（和平时期发展经济）

## 📊 完成度

| 模块 | 完成度 | 状态 |
|------|--------|------|
| 核心系统 | 95% | ✅ 完成 |
| 数据管理 | 100% | ✅ 完成 |
| 存档系统 | 100% | ✅ 完成 |
| UI组件 | 90% | ✅ 基本完成 |
| 玩家交互 | 40% | ⚠️ 进行中 |
| 游戏进程 | 70% | ⚠️ 进行中 |
| LLM集成 | 100% | ✅ 完成 |

**总体完成度：约75-80%**

## 🔧 待实现功能

### 高优先级
- [ ] 玩家内政指令的具体逻辑实现
- [ ] 玩家军事指令的具体逻辑实现
- [ ] 武将选择界面
- [ ] 目标城市选择界面

### 中优先级
- [ ] 计略系统（离间、破坏、间谍等）
- [ ] 胜利条件判定
- [ ] 游戏结束界面
- [ ] 势力灭亡逻辑

### 低优先级
- [ ] 战斗动画效果
- [ ] 音效系统
- [ ] 游戏教程
- [ ] 难度设置

## 🧪 测试

项目采用属性测试（Property-based Testing）确保核心逻辑正确性：

- ✅ 战斗系统测试
- ✅ 内政系统测试
- ✅ 回合系统测试
- ✅ 存档系统测试
- ✅ 地图系统测试

运行测试：
```bash
npm run test
```

## 📝 开发日志

### v0.1.0 (2026-01-10)
- ✅ 完成基础框架搭建
- ✅ 实现核心游戏系统
- ✅ 完成190年剧本数据
- ✅ 实现自动/手动存档
- ✅ 集成LLM服务
- ✅ 完成主要UI组件
- ⚠️ 玩家交互逻辑待完善

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📄 许可证

MIT License

## 👨‍💻 作者

Liam Payne

## 🙏 致谢

- 光荣公司《三国志》系列游戏的启发
- React、Vite、TypeScript 等优秀开源项目
- fast-check 属性测试库
- Google Gemini API

---

**⚔️ 乱世已至，英雄当立！**
